{"version":3,"sources":["webpack:///path---basic-asymmetric-multi-processor-amp-setup-on-the-zedboard-2ffab0a6140080d606c2.js","webpack:///./.cache/json/basic-asymmetric-multi-processor-amp-setup-on-the-zedboard.json"],"names":["webpackJsonp","454","module","exports","data","markdownRemark","html","timeToRead","excerpt","frontmatter","title","cover","date","category","tags","fields","nextTitle","nextSlug","prevTitle","prevSlug","slug","pathContext"],"mappings":"AAAAA,cAAc,iBAERC,IACA,SAAUC,EAAQC,GCHxBD,EAAAC,SAAkBC,MAAQC,gBAAkBC,KAAA;AAAq1xCC,WAAA,GAAAC,QAAA,+IAAAC,aAA6yFC,MAAA,+DAAAC,MAAA,kBAAAC,KAAA,mBAAAC,SAAA,OAAAC,MAAA,uCAA2LC,QAAWC,UAAA,KAAAC,SAAA,KAAAC,UAAA,KAAAC,SAAA,KAAAC,KAAA,iEAAyIC,aAAgBD,KAAA","file":"path---basic-asymmetric-multi-processor-amp-setup-on-the-zedboard-2ffab0a6140080d606c2.js","sourcesContent":["webpackJsonp([215454216127061],{\n\n/***/ 454:\n/***/ (function(module, exports) {\n\n\tmodule.exports = {\"data\":{\"markdownRemark\":{\"html\":\"<h2 id=\\\"table-of-contents\\\"><a href=\\\"#table-of-contents\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Table of Contents</h2>\\n<ul>\\n<li><a href=\\\"#introduction\\\">Introduction</a></li>\\n<li><a href=\\\"#concept\\\">Concept</a></li>\\n<li>\\n<p><a href=\\\"#block-design\\\">Block Design</a></p>\\n<ul>\\n<li><a href=\\\"#microblaze\\\">Microblaze</a></li>\\n<li><a href=\\\"#ps\\\">PS</a></li>\\n<li><a href=\\\"#axi-interconnect\\\">AXI Interconnect</a></li>\\n<li><a href=\\\"#bram-mux\\\">BRAM mux</a></li>\\n<li><a href=\\\"#address-map\\\">Address map</a></li>\\n</ul>\\n</li>\\n<li>\\n<p><a href=\\\"#sdk\\\">SDK</a></p>\\n<ul>\\n<li>\\n<p><a href=\\\"#cross-compilation\\\">Cross compilation</a></p>\\n<ul>\\n<li><a href=\\\"#ps-1\\\">PS</a></li>\\n<li><a href=\\\"#microblaze-1\\\">Microblaze</a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"#project-design_1_wrapper_hw_platform_0\\\">Project: design_1_wrapper_hw_platform_0</a></li>\\n<li><a href=\\\"#project-ps_device_tree-device-tree\\\">Project: ps_device_tree Device tree</a></li>\\n<li><a href=\\\"#project-ps_mem_util-linux-shared-memory-utility\\\">Project: ps_mem_util Linux shared memory utility</a></li>\\n<li><a href=\\\"#project-mb_bsp-board-support-package-for-the-microblaze-processor\\\">Project: mb_bsp Board support package for the Microblaze processor</a></li>\\n<li><a href=\\\"#project-mb_hello-hello-world-application-for-microblaze\\\">Project: mb_hello Hello World application for Microblaze</a></li>\\n<li><a href=\\\"#project-mb_test-shared-memory-test-application-for-microblaze\\\">Project: mb_test Shared memory test application for Microblaze</a></li>\\n</ul>\\n</li>\\n<li>\\n<p><a href=\\\"#yocto\\\">Yocto</a></p>\\n<ul>\\n<li><a href=\\\"#device-tree\\\">Device tree</a></li>\\n<li><a href=\\\"#kernel\\\">Kernel</a></li>\\n<li><a href=\\\"#toolchain\\\">Toolchain</a></li>\\n<li><a href=\\\"#root-filesystem\\\">Root filesystem</a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"#testing\\\">Testing</a></li>\\n<li><a href=\\\"#conclusion\\\">Conclusion</a></li>\\n</ul>\\n<h1 id=\\\"introduction\\\"><a href=\\\"#introduction\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Introduction</h1>\\n<p>This article continues building upon the Linux platform which was set up in the previous article. Targeting the development of a music synthesizer, several building blocks have been explored: </p>\\n<ul>\\n<li>Hardware platform: Zynq 7020, Zedboard</li>\\n<li>Linux running on PS (dual core): systems management (MIDI, firmware management, embedded website)</li>\\n<li>I2S transmitter (implemented in logic), audio out</li>\\n<li>Sine wave oscillator</li>\\n<li>Possible use of a Microblaze softcore processor as co-processor.</li>\\n</ul>\\n<p>The synthesis engine will be implemented in logic (PL). The synthesis engine employs the additive synthesis method. It will support 32 voices, each voice will consist of 1024 oscillators. Each oscillator consists of a simple sine wave with frequency, amplitude and pan parameters. Furthermore there will be a noise generator for each oscillator that can add band limited noise. In total this means that 32768 oscillators have to be realized. These oscillators need to output 24 bit stereo samples at 44 kHz. </p>\\n<p>Input to the audio engine are the slowly varying frequency, amplitude, pan and noise parameters. Some sort of \\\"envelope generator\\\" is needed for this purpose. The idea is to have the oscillator tracks i ready to be used in main memory. Each track consists of frequency, amplitude, pan and noise parameters stored at 20 Hz time resolution. This data needs to be streamed to the audio engine which will then use this data to update the oscillators and provide the audio samples. The envelope generator needs to be able to respond in 5 ms to an event (eg. stop or start of a voice). Any more delay will be noticeable when using the synthesizer in a live performance. </p>\\n<p>It would be great if the envelope generator could be developed using a traditional programming language instead of resorting to a pure logic approach. A standard programming language would offer more ease while development and possibly greater flexibility. However an important drawback could be the performance of the software as the software needs to provide data at 20 Hz for 32768 oscillators. In this article and the following article I will focus on the feasibility to use a Microblaze softcore as a envelope generator. This article focuses on the basic architecture. In the next article I will be investigating the performance.</p>\\n<h1 id=\\\"concept\\\"><a href=\\\"#concept\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Concept</h1>\\n<p>This article describes the following work:</p>\\n<ul>\\n<li>Addition of a Microblaze softcore to the Zynq 7020 FPGA.</li>\\n<li>Program the Microblaze from Linux running on the PS.</li>\\n<li>Running bare metal firmware on the Microblaze.</li>\\n<li>Providing shared DDR memory between Linux and the Microblaze (Asymmetric Multi Processing).</li>\\n<li>Using Yocto to configure the Linux platform.</li>\\n</ul>\\n<p>Simplified the design consists of the following components:</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/schematic-14adae51be8797778242851946564e53-cefc6.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 793px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 96.09079445145018%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAAB00lEQVQ4y6WUCW7CMBBFuf/JipAKAgFhJ4hshIQlYV+mflYdWRCq0lqaOoyc5z9/Jq2IWpfLRY7Ho471ei1RGEij0ZAgCOV2u8k7q8Kf7XYj9/tdDBzoYrGQNE3/BsyyrABer1fZ7/eyWq1kt9sV+TcVbnW5KELdaDQUx+mJ687kfD5r1XZw6Y/A5XJZJCgRZVEUSZ7npQqBvgRS2qDfl8D3ZbPZyOFw0Ip7/Z7eKd9e5BJVyUtgtfoh7XZHOu22zGYzpTaWer0urWZTRUsypfIthXhnL/wht0wSrdbuMs/AyNs+2v4WQEozczgejaVWq8l0OtUTYGYUezzfE1dVwjM54DRzPB5JrHpRAM1OV2kIwUG7PM7gITAuNg3jUvLEE9A8A2ZHOS8TgPh9Op0KezhX6qHZucVxHD0y5FDIGNmRW416bNAT0PPm8qm6PBwM9cv/BrIw2n4BCD6VAfM8KyzQQIznAP5Qruk4nqVpojvKl5SocF33O5/KZDJ5apoG2jcDtVUC8tUXFIah/ooIzsTxQvwgUHtcDux2uroRHDLzaGYsUQOOEtRzFigqzWD/WqHxFY/4rwOYiKJQ5p6nwaVAFOEhB4DbC7MfZ9D8Nn4/Ar8ArcbDuIf0B7UAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"AMP schematic\\\"\\n        title=\\\"Asymmetric Multi Processing (AMP) setup\\\"\\n        src=\\\"/static/schematic-14adae51be8797778242851946564e53-cefc6.png\\\"\\n        srcset=\\\"/static/schematic-14adae51be8797778242851946564e53-3e77c.png 300w,\\n/static/schematic-14adae51be8797778242851946564e53-d20dc.png 600w,\\n/static/schematic-14adae51be8797778242851946564e53-cefc6.png 793w\\\"\\n        sizes=\\\"(max-width: 793px) 100vw, 793px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<h1 id=\\\"block-design\\\"><a href=\\\"#block-design\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Block Design</h1>\\n<h2 id=\\\"microblaze\\\"><a href=\\\"#microblaze\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Microblaze</h2>\\n<p>The Microblaze is configured to run code out of local BRAM memory. Furthermore it has a data cache to speed up accesses to DDR memory. The cache is connected via the HP0 port of the Zynq. This allows the Microblaze to access the DDR memory of the Zed board. This memory is shared with the Linux platform. </p>\\n<p>The Microblaze reset signal is connected to an AXI GPIO peripheral. This allows the Microblaze to be reset from Linux. The Xilinx SDK can generate some example applications. These applications require an uart is required. The Microblaze is configured with an AXI uartlite. This uart is connected to uart0 of the PS. This allows the serial output to be read from Linux without using any external cabling.</p>\\n<p>We want to use Linux to setup the firmware of the Microblaze. Thus Linux needs to have access to the BRAM. Unfortunately BRAM is only dual port, and both ports are in use by the Microblaze. A mux has been implemented which allows Linux to take control of the BRAM while the Microblaze is in reset. This will make it possible to program the Microblaze from within Linux.</p>\\n<h2 id=\\\"ps\\\"><a href=\\\"#ps\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>PS</h2>\\n<ul>\\n<li>\\n<p>The following PS peripherals are required in this project:</p>\\n<ul>\\n<li>PS Uart0 (auxiliary serial communication between Microblaze and Linux)</li>\\n<li>PS Uart1 (Linux console command line terminal)</li>\\n<li>DDR Ram</li>\\n<li>SD card (boot and root partition Linux)</li>\\n<li>M_AXI_GP0 (Access AXI peripherals) </li>\\n<li>S_AXI_HP0 (Microblaze access DDR RAM)</li>\\n</ul>\\n</li>\\n</ul>\\n<h2 id=\\\"axi-interconnect\\\"><a href=\\\"#axi-interconnect\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>AXI Interconnect</h2>\\n<p>The interconnect has two slave interfaces. One is connected to the PS, the other one to the Microblaze. This allows both the Microblaze and PS to access peripherals. The interconnect is attached to GPIO, a BRAM controller and an UARTlite. The peripherals have the following functions:</p>\\n<ul>\\n<li>\\n<p>The GPIO is used to control LEDs,  the Microblaze reset signal and the BRAM mux. </p>\\n<ul>\\n<li>The reset and mux signals have also been connected to LEDs and are controlled by the PS.</li>\\n<li>The remaining LEDs are controlled by both PS and Microblaze. </li>\\n</ul>\\n</li>\\n<li>The BRAM controller is used to allow accesses to the Microblaze BRAM from the PS.</li>\\n<li>The UARTlite is used by the Microblaze. The UARTlite is connected to the PS Uart0.</li>\\n</ul>\\n<h2 id=\\\"bram-mux\\\"><a href=\\\"#bram-mux\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>BRAM mux</h2>\\n<p>The BRAM mux allows one to connect two BRAM controllers to a single BRAM port. A control signal selects which BRAM controller is connected to the BRAM. In Vivado the IP packager was used to wrap a small VHDL module. In the IP packager the individual in and outputs of the VHDL entity can be grouped into bus interfaces. BRAM uses \\\"BRAM_CTRL\\\" interfaces. Some remarks:</p>\\n<ul>\\n<li>In a first try I packaged a block design with an embedded/referenced RTL module as an IP. Although this seems to be supported since Vivado 2018.1 I was not able to get this to work. When using the IP I always got an error during implementation of the design that the referenced RTL module could not be found while using the IP (Black box instantiation error).</li>\\n<li>Although the types of the input and output interfaces were set to BRAM_CTRL during packaging,  the type was showed as 'OTHER' while using the IP. This was solved by manually updating the block design in which the IP is used.</li>\\n</ul>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/bram_interface-13b114dea36fcf16a708a711f48fd751-a7362.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 1082px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.41774491682071%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABW0lEQVQoz5WRXU/CMBSG9/fVsYFeacQfYTDxTuOFIsog3MDGhAQY29w61m5r126LnkkgAyLRJ03ztul7vio93rdumlfN68uLc0WRTxqqXFfPVOW0UQchKzUQNTiqpZDvWreU0uQHENJivghXYRzFcP46Cks/bcfKsmx7I01nNsE4QEEcx2ma4hAjhHzP9zwPHzA2pyGhMRXrJVmWtY0EUaEE8JOIzpfIDxIcsayCMZ7sZLZtu2qG8OEKc84jgoVgIKqV75td193JDERl/a5rRcQXQhyaV1HqIoITLjmOI7IiIIkfQCqRshSyCS4YY3meF0VRNY90c2jOR5OlE7KZn5TmLC9iyhPG140dGfhwpMMDQkUYc5jGfs9/Mf/a8//Me1/1P7O9tOlRYPzlzxOCfGSaHzBIsUHSdX0wGHS72mvn/aX91m53Hp6eNU3r9XrrfUu/3zcMA2IlG74BacTXS1fd5DsAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"BRAM mux interface\\\"\\n        title=\\\"BRAM interface\\\"\\n        src=\\\"/static/bram_interface-13b114dea36fcf16a708a711f48fd751-a7362.png\\\"\\n        srcset=\\\"/static/bram_interface-13b114dea36fcf16a708a711f48fd751-1e477.png 300w,\\n/static/bram_interface-13b114dea36fcf16a708a711f48fd751-43255.png 600w,\\n/static/bram_interface-13b114dea36fcf16a708a711f48fd751-a7362.png 1082w\\\"\\n        sizes=\\\"(max-width: 1082px) 100vw, 1082px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<h2 id=\\\"address-map\\\"><a href=\\\"#address-map\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Address map</h2>\\n<p>Below you find an overview of the address of the various peripherals. </p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/address-780260080dd2af7cc08c080bb1274780-93fca.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 993px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 50.35246727089627%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABNUlEQVQoz5VR2U7DMBDM/38gDwjRJk7s+Frfac6KcQMF8QQrazWTvSfNpTdcEuN6EEZT1pSUjX98zYUZoZzzMeXp19OGpDTVKwuqlJXKGFOTla64acf88spf3+VbZ7mdez0JWnQ88KQ//abCDjC6VdAKCowc0CZNm7XEWpZT3rbt/sOMOeCtsfu+A/B+YF1PlpDG2k4KVYtLKQiMQoYQ5nl5FudUPaInTTF5H27TDRiZOZeGQhaD8M7PqFuW4z9WJ8cQRzGu64qW+PSc7Khi9D2pkpLzOgZXCC6U1LUY/Hq5DmzAPdit5HIur+QBESD37WHnzY4cFuyu7efNKaW+Y1/Lf98c4x1KTWWCQSREnXPogu2AMKOJZSX8yVHWP0iIe8iO3lWwXFuc2Q/9UowR0oAClDJ9ABB6OSg8EvJNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"AXI address map\\\"\\n        title=\\\"Address Map\\\"\\n        src=\\\"/static/address-780260080dd2af7cc08c080bb1274780-93fca.png\\\"\\n        srcset=\\\"/static/address-780260080dd2af7cc08c080bb1274780-85d1c.png 300w,\\n/static/address-780260080dd2af7cc08c080bb1274780-28c3d.png 600w,\\n/static/address-780260080dd2af7cc08c080bb1274780-93fca.png 993w\\\"\\n        sizes=\\\"(max-width: 993px) 100vw, 993px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>Note that the UartLite is not used by the PS and the BRAM controller is not used by the Microblaze.</p>\\n<h1 id=\\\"sdk\\\"><a href=\\\"#sdk\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>SDK</h1>\\n<p>The block design was synthesized and exported to the SDK. In the SDK several projects were created. </p>\\n<h2 id=\\\"cross-compilation\\\"><a href=\\\"#cross-compilation\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Cross compilation</h2>\\n<p>To develop and compile software on a development X86 platform cross compilation toolchains are required. In the AMP design a toolchain for the PS (ARM A9) and Microblaze will be used.</p>\\n<h3 id=\\\"ps-1\\\"><a href=\\\"#ps-1\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>PS</h3>\\n<p>Vivado is delivered including the ARM toolchain required for compiling programs for the Zynq A9 processors. Yocto can also generate the cross compilation toolchain. In order to test Yocto, the toolchain generated by Yocto is used. See the toolchain paragraph in the Yocto section for more info. To use the Yocto toolchain in the Xilinx SDK (Eclipse) right click a project and then select \\\"C/C++ build -> Settings\\\". Use the following settings (replace 'sdk install path' with the correct path):</p>\\n<div style='overflow:auto;width:100%'>\\n<pre>\\nAssembler: \\n  [sdk install path]/sysroots/ x86_64-pokysdk-linux/ usr/ bin/arm-poky-linux-gnueabi/arm-poky-linux-gnueabi-gcc\\nCompiler: \\n  [sdk install path]/sysroots/x86_64-pokysdk-linux/usr/bin/arm-poky-linux-gnueabi/arm-poky-linux-gnueabi-gcc\\n  All options: -Wall -O0 -g3 -I\\\"[sdk install path]/sysroots/cortexa9hf-neon-poky-linux-gnueabi/usr/include\\\" -c -fmessage-length=0 -MT\\\"$@\\\" -march=armv7-a -marm -mfpu=neon -mfloat-abi=hard -mcpu=cortex-a9 --sysroot=[sdk install path]/sysroots/cortexa9hf-neon-poky-linux-gnueabi\\n  Directories - Include paths: [sdk install path]/sysroots/cortexa9hf-neon-poky-linux-gnueabi/usr/include \\n  Miscellaneous : -c -fmessage-length=0 -MT\\\"$@\\\" -march=armv7-a -marm -mfpu=neon -mfloat-abi=hard -mcpu=cortex-a9 --sysroot=[sdk install path]/sdk/sysroots/cortexa9hf-neon-poky-linux-gnueabi\\nLinker:\\n  Command: /home/dinne/yocto/sdk/sysroots/x86_64-pokysdk-linux/usr/bin/arm-poky-linux-gnueabi/arm-poky-linux-gnueabi-gcc\\n  All options: -L\\\"[sdk install path]/sdk/sysroots/cortexa9hf-neon-poky-linux-gnueabi/usr/lib\\\" -L\\\"[sdk install path]/sysroots/cortexa9hf-neon-poky-linux-gnueabi/lib\\\" --sysroot=[sdk install path]/sysroots/cortexa9hf-neon-poky-linux-gnueabi\\n  Libraries: [sdk install path]/sysroots/cortexa9hf-neon-poky-linux-gnueabi/usr/lib \\n    and \\n             [sdk install path]/sysroots/cortexa9hf-neon-poky-linux-gnueabi/lib\\n  Miscellaneous: --sysroot=[sdk install path]/sysroots/cortexa9hf-neon-poky-linux-gnueabi\\n</pre>\\n</div>\\n&nbsp;\\n&nbsp;\\n<h3 id=\\\"microblaze-1\\\"><a href=\\\"#microblaze-1\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Microblaze</h3>\\n<p>The toolchain included in Vivado was used to compile the Microblaze examples. A post build command was added to generate the .bin images which can be copied into the BRAM.</p>\\n<div style='overflow:auto;width:100%'>\\n<pre>mb-objcopy -I elf32-microblaze -O binary --strip-debug mb_hello.elf mb_hello.bin</pre>\\n</div>\\n<h2 id=\\\"project-design_1_wrapper_hw_platform_0\\\"><a href=\\\"#project-design_1_wrapper_hw_platform_0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Project: design_1_wrapper_hw_platform_0</h2>\\n<p>Contains the fpga bit file. </p>\\n<h2 id=\\\"project-ps_device_tree-device-tree\\\"><a href=\\\"#project-ps_device_tree-device-tree\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Project: ps_device_tree Device tree</h2>\\n<p>This project generates the device trees required for Yocto Linux.</p>\\n<h2 id=\\\"project-ps_mem_util-linux-shared-memory-utility\\\"><a href=\\\"#project-ps_mem_util-linux-shared-memory-utility\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Project: ps_mem_util Linux shared memory utility</h2>\\n<p>This project builds a simple memory IO utility. It allows one to read or write a range of physical memory addresses. The utility can copy a file to memory or read a file from memory. </p>\\n<ul>\\n<li>The utility can be used to copy shared memory to a file. In this case memory is read from the range 0x1000_0000 - 0x1e00_0000</li>\\n<li>The utility can be used to program the Microblaze. In this case a file is copied to memory location 0x4000_0000 - 0x4000_7FFF</li>\\n</ul>\\n<p>The utility makes use of the Linux mmap function. To access memory:</p>\\n<ol>\\n<li>Open the \\\"/dev/mem\\\" device with O_RDWR and O_SYNC options. O_SYNC is required to disable caching.</li>\\n<li>\\n<p>Use mmap:</p>\\n<div style='overflow:auto;width:100%'>\\n<pre>\\nbase_address = mmap(0, size_rounded, PROT_READ, MAP_SHARED | MAP_UNINITIALIZED, fd, load_address);\\n</pre>\\n</div>\\n</li>\\n</ol>\\n<p>where \\\"size_rounded\\\" is the size of the memory area roundup to the nearest size in whole pages.  \\\"load_address\\\" is the physical address which will be mapped. The returned \\\"base_address\\\" is a pointer to the mapped memory. </p>\\n<ol start=\\\"3\\\">\\n<li>\\n<p>The memory can then be accessed:</p>\\n<div style='overflow:auto;width:100%'>\\n<pre>base\\\\_address[offset] = data</pre>\\n</div>\\n</li>\\n</ol>\\n<p>Have look at the ps_mem_util source code for the details. Note that the code is only a \\\"proof of concept\\\" and is very inefficient.</p>\\n<p>Note. According to the mmap documentation the first parameter is a hint to the address that should be mapped. The last argument is the offset. Initially I tried: </p>\\n<div style='overflow:auto;width:100%'>\\n<pre>\\n    base_address = mmap(load_address, size_rounded, PROT_READ, MAP_SHARED | MAP_UNINITIALIZED | MAP_FIXED, fd, 0);\\n</pre>\\n</div>\\nFor reasons unknown to me this does not work!\\n<p> \\n </p>\\n<h2 id=\\\"project-mb_bsp-board-support-package-for-the-microblaze-processor\\\"><a href=\\\"#project-mb_bsp-board-support-package-for-the-microblaze-processor\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Project: mb_bsp Board support package for the Microblaze processor</h2>\\n<p>A board support package was generated for the Microblaze processor. Libmetal was disabled in order to fit the example application into 32kB BRAM.</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/mb_bsp-58486d814463a539d40b138a806592e7-3006c.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 1200px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 45.62500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABXUlEQVQoz22QW07DMBBFs//FID7YACqF8hSg/qC2qRPH9sTxu0lqkrRhoqIKAdaRJcs+c2ecGEENp4ZlihdGVVZXuEsQm9UHSdc5Sf9FsCJYk/j1MiwXNdCdd7FtjsMwHg48z2az6/nN7H5xd3c7f3p8eHl++snV5cXxeEyckpIzpZT3PoRQ13WMURaZebs127SEyhrNOSsoPYMHEGKSd86KYort4h7pPyNitOr73tlAtoBD0DzPswwFAAGClyAozbuuS2otGwWNkkPfHfp+QIbBWjuOo3c7lAVHhWMJpJLfu+AMqydt03zGuG/3QghT7jq26TmxLEcZrzBNyrIEcM62TX0Gw6e2T6MqpbGpirm4fu/OctsAlM45Sulqtd5sUgCQUqLCOZ9kC8wb7Yyugx8Pwwnv7EnGpzgCZ4wQwhhD2RgTgodTMrY+/llaa/wjOpH9gmzT7HVBli8ofwHXI+6CVv2SqAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"Mircoblaze bsp\\\"\\n        title=\\\"Microblaze board support package\\\"\\n        src=\\\"/static/mb_bsp-58486d814463a539d40b138a806592e7-bf66f.png\\\"\\n        srcset=\\\"/static/mb_bsp-58486d814463a539d40b138a806592e7-e6e4d.png 300w,\\n/static/mb_bsp-58486d814463a539d40b138a806592e7-04aa4.png 600w,\\n/static/mb_bsp-58486d814463a539d40b138a806592e7-bf66f.png 1200w,\\n/static/mb_bsp-58486d814463a539d40b138a806592e7-3006c.png 1760w\\\"\\n        sizes=\\\"(max-width: 1200px) 100vw, 1200px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<h2 id=\\\"project-mb_hello-hello-world-application-for-microblaze\\\"><a href=\\\"#project-mb_hello-hello-world-application-for-microblaze\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Project: mb_hello Hello World application for Microblaze</h2>\\n<p>The Xilinx \\\"test peripheral\\\" template was chosen. Check that the ldscript.ld Linker script only references the BRAM. </p>\\n<p>The test application flash all the GPIOs/LEDs. Bit 13 and 12 of the GPIO are reserved for the PS to reset the Microblaze and to control the BRAM Mux. The test code is modified so that it doesn't toggle these bits :).</p>\\n<h2 id=\\\"project-mb_test-shared-memory-test-application-for-microblaze\\\"><a href=\\\"#project-mb_test-shared-memory-test-application-for-microblaze\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Project: mb_test Shared memory test application for Microblaze</h2>\\n<p>This application shows how to write to the shared memory. First the address of the start of shared memory is obtained:</p>\\n<pre>uint32_t addr = XPAR_PS7_DDR_0_HP0_AXI_BASENAME;</pre>\\n<p>Next a byte can be changed as follows:</p>\\n<pre>\\t\\t\\ndata_ptr = (uint8_t*)(addr+offset);\\n*data_ptr = value;\\n</pre>\\n<p>Again note that is purely \\\"proof of concept\\\" and not an example of efficient memory accessing! Note also that in this example the caches have been disabled.</p>\\n<h1 id=\\\"yocto\\\"><a href=\\\"#yocto\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Yocto</h1>\\n<p>The Linux kernel is built using Yocto. The yocto tools are available using Docker. First build the docker image:</p>\\n<pre>\\ncd yocto\\nmake image\\n</pre>\\n<p>Then start a container in which to perform work:</p>\\n</pre>./run.sh</pre>\\n<p>Inside the container, first perform <pre>su [username]</pre> to get to the right user. Then cd to your home dir (which is mounted inside the container) and then to the yocto dir. Next run the build.sh script to build the Yocto image. This will take a while!</p>\\n</pre>./build.sh</pre>\\n<p>If you want to make changes to the configuration refer the sections below. Reconfiguring the kernel must be done from inside the container environment. After saving the changes rebuild the image:</p>\\n<div style='overflow:auto;width:100%'>\\n<pre>\\ncd yocto_zedboard/yocto_build_env/poky\\nsource oe-init-build-env\\nbitbake bitbake core-image-minimal\\n</pre>\\n</div>\\n<p>Note: Bitbake currently uses Python2. I use conda to switch to Python2 before using the bitbake utility.</p>\\n<h2 id=\\\"device-tree\\\"><a href=\\\"#device-tree\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Device tree</h2>\\n<p>The device tree generated by Vivado is a good starting point for further customization. Some changes were made:</p>\\n<ul>\\n<li>The memory range 0x1000_0000 to 0x1e00_0000 is setup as \\\"reserved memory\\\". The Linux kernel will not use this memory. The memory will be available for use as shared memory between the Microblaze processor and Linux user space applications. </li>\\n<li>Vivado automatically added an AXI uartlite device. However this device will be only used by the Microblaze. Thus the AXI UartLite is removed and the Uart indexes have been shifted accordingly.</li>\\n</ul>\\n<p>The AXI GPIO and AXI Bram controller have been integrated unchanged from the Vivado device tree files. The modified device tree files can be found in the Yocto 'meta-dts' layer (yocto/meta-dts/recipes-kernel/linux/linux-xlnx/zedboard-zynq7)</p>\\n<h2 id=\\\"kernel\\\"><a href=\\\"#kernel\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Kernel</h2>\\n<p>During development it's nice to have more debugging facilities on the Linux platform. Therefore the debugfs tools have been enabled in the kernel. In yocto it is possible to override the kernel configuration file completely. It is also possible to specify only changed configuration options in a socalled 'fragment'. The changed options are merged by Yocto into the kernel configuration. A pre configured fragment can be found in yocto/meta-dts/recipes-kernel/linux/linux-xlnx/zedboard-zynq7/fragment.cfg. </p>\\n<p>Creating a fragment can be done as follows (this has already been done in the repo):</p>\\n<ul>\\n<li>\\n<p>First build a minimal image </p>\\n<pre>bitbake core-image-minimal</pre>\\n</li>\\n<li>\\n<p>configure the kernel</p>\\n<pre>bitbake linux-xlnx -c menuconfig</pre>\\n</li>\\n<li>\\n<p>Then create a diff fragment</p>\\n<pre>bitbake linux-xlnx -c diffconfig</pre>\\n</li>\\n<li>Copy the fragment to the meta-dts layer and add it to the kernel recipes-kernel/linux/linux-xlnx_%.bbappend file.  </li>\\n<li>\\n<p>Rebuild the image</p>\\n<pre>bitbake core-image-minimal</pre>\\n</li>\\n</ul>\\n<h2 id=\\\"toolchain\\\"><a href=\\\"#toolchain\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Toolchain</h2>\\n<p>Yocto can generate an installer with the cross compilers required for build software for the Zynq Linux platform. The SDK can be generated by using bitbake</p>\\n<pre>bitbake core-image-minimal -c populate_sdk</pre>\\n<p>Initially this command gave a number of errors because of missing dependencies, these have been added to the yocto/ meta-dts/ recipes-kernel/ linux/ kernel-devsrc.bbappend file.</p>\\n<p>After building the SDK can be found in:</p>\\n<div style='overflow:auto;width:100%'>\\n<pre>\\npoky/build/tmp/work/zedboard_zynq7-poky-linux-gnueabi/core-image-minimal/1.0-r0/x86_64-deploy-core-image-minimal-populate-sdk/ poky-glibc-x86_64-core-image-minimal-cortexa9hf-neon-toolchain-2.5.2.sh\\n</pre>\\n</div>\\n<p>Execute the script to install the SDK.</p>\\n<h2 id=\\\"root-filesystem\\\"><a href=\\\"#root-filesystem\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Root filesystem</h2>\\n<p>I use an Ubuntu root filesystem. Installing this is described in the previous article. One patch is needed. The toolchain compiled by Yocto expects the system library to be at a certain location. If it is not then execution of applications compiled with the toolchain will fail with a very vague error. To get the applications built with the Yocto toolchain working a sym link has to be added.</p>\\n<h1 id=\\\"testing\\\"><a href=\\\"#testing\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Testing</h1>\\n<p>After building the Linux kernel copy the files to an SD card. Formatting the SD card is described in the previous article. </p>\\n<p>Copy the files located in \\\"poky/build/tmp/deploy/images/zedboard-zynq7\\\" to the boot partition:</p>\\n<ul>\\n<li>\\n<p>boot.bin -> boot/boot.bin The first stage bootloader</p>\\n</li>\\n<li>\\n<p>system-top.dtb -> uImage-system-top.dtb (Compiled device tree)</p>\\n</li>\\n<li>\\n<p>u-boot.img -> u-boot.img (Kernel bootloader)</p>\\n</li>\\n<li>\\n<p>uImage -> uImage (Linux kernel)</p>\\n</li>\\n<li>\\n<p>Add a uEnv.txt file:</p>\\n<div style='overflow:auto;width:100%'>\\n<pre>\\nmachine_name=zedboard-zynq7\\nkernel_image=uImage\\nkernel_load_address=0x2080000\\ndevicetree_image=uImage-system-top.dtb\\ndevicetree_load_address=0x2000000\\nbootargs=console=ttyPS0,115200 root=/dev/mmcblk0p2 rw earlyprintk rootfstype=ext4 rootwait devtmpfs.mount=1\\nloadkernel=fatload mmc 0 ${kernel_load_address} ${kernel_image}\\nloaddtb=fatload mmc 0 ${devicetree_load_address} ${devicetree_image}\\nbootkernel=run loadkernel && run loaddtb && bootm ${kernel_load_address} - ${devicetree_load_address}\\nuenvcmd=run bootkernel\\n</pre>\\n</div>\\n</li>\\n</ul>\\n<p> \\n </p>\\n<ul>\\n<li>\\n<p>Convert the fpga bit file (in the design_1_wrapper_hw_platform_0) to a fpga.bin file using the yocto/fpga-bit-to-bin.py script. Copy it to the boot partition -> fpga.bin</p>\\n</li>\\n<li>\\n<p>Copy the compiled executable ps_mem_util.elf (from the SDK) to the root partition /root/ubuntu/</p>\\n</li>\\n<li>\\n<p>Copy the mb_test.bin and mb_hello.bin firmware images (from the SDK) to the root partition /root/ubuntu/</p>\\n</li>\\n<li>\\n<p>Copy the microblaze scripts program_mb, unlock_bram and release_mb from the yocto_zedboard/yocto/linux_utils/ folder to the root partition /root/ubuntu</p>\\n</li>\\n</ul>\\n<p>Unmount the SD card and plug it in the Zedboard. Connect a USB cable to UART connector and power on the Zed board. Wait a +/- 20 second and then use a terminal program to open a serial terminal (eg. /dev/ttyACM0). Press the PS-RST button to reboot linux. You should see the boot messages on the terminal.</p>\\n<p>Login as root. </p>\\n<p>Use the Perform the following commands:</p>\\n<pre>\\n./program_mb mb_hello.bin\\n./unlock_bram.sh\\n./release_mb.sh\\n</pre>\\n<p>You should see the LEDs being turned on and off by the Microblaze.</p>\\n<p>Test the shared memory:</p>\\n<pre>\\n/program_mb mb_test.bin\\n./unlock_bram.sh\\n./release_mb.sh\\n</pre>\\n<p>Wait a second and then use the ps_mem_utility to read 512 bytes from the shared memory:</p>\\n<pre>\\nps\\\\_mem\\\\_util r 0x10000000 512 test.bin\\n</pre>\\n<p>This file should contain increasing numbers which were written in the memory by the microblaze.</p>\\n<h1 id=\\\"conclusion\\\"><a href=\\\"#conclusion\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Conclusion</h1>\\n<p>This article showed how to set up a basic AMP system using Linux on the ARM A9 cores and a bare metal Microblaze core.  It will be interesting to see if enough performance can be squeezed out of the  Microblaze to handle streaming the sine track parameters. This will be investigated further in the following article.</p>\\n<p>The Vivado project, VHDL code and Yocto files can be found in the <a href=\\\"https://github.com/dwjbosman/yocto_zedboard.git\\\">yocto_zedboard</a> repository in the AMP branch.</p>\",\"timeToRead\":15,\"excerpt\":\"Table of Contents Introduction Concept Block Design Microblaze PS AXI Interconnect BRAM mux Address map SDK Cross compilation PS Microblaze…\",\"frontmatter\":{\"title\":\"Basic Asymmetric Multi Processor (AMP) setup on the Zedboard\",\"cover\":\"/logos/cpus.jpg\",\"date\":\"2019-03-05 09:00\",\"category\":\"FPGA\",\"tags\":[\"Zynq Microblaze Yocto Linux Xilinx\"]},\"fields\":{\"nextTitle\":null,\"nextSlug\":null,\"prevTitle\":null,\"prevSlug\":null,\"slug\":\"/basic-asymmetric-multi-processor-amp-setup-on-the-zedboard\"}}},\"pathContext\":{\"slug\":\"/basic-asymmetric-multi-processor-amp-setup-on-the-zedboard\"}}\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// path---basic-asymmetric-multi-processor-amp-setup-on-the-zedboard-2ffab0a6140080d606c2.js","module.exports = {\"data\":{\"markdownRemark\":{\"html\":\"<h2 id=\\\"table-of-contents\\\"><a href=\\\"#table-of-contents\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Table of Contents</h2>\\n<ul>\\n<li><a href=\\\"#introduction\\\">Introduction</a></li>\\n<li><a href=\\\"#concept\\\">Concept</a></li>\\n<li>\\n<p><a href=\\\"#block-design\\\">Block Design</a></p>\\n<ul>\\n<li><a href=\\\"#microblaze\\\">Microblaze</a></li>\\n<li><a href=\\\"#ps\\\">PS</a></li>\\n<li><a href=\\\"#axi-interconnect\\\">AXI Interconnect</a></li>\\n<li><a href=\\\"#bram-mux\\\">BRAM mux</a></li>\\n<li><a href=\\\"#address-map\\\">Address map</a></li>\\n</ul>\\n</li>\\n<li>\\n<p><a href=\\\"#sdk\\\">SDK</a></p>\\n<ul>\\n<li>\\n<p><a href=\\\"#cross-compilation\\\">Cross compilation</a></p>\\n<ul>\\n<li><a href=\\\"#ps-1\\\">PS</a></li>\\n<li><a href=\\\"#microblaze-1\\\">Microblaze</a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"#project-design_1_wrapper_hw_platform_0\\\">Project: design_1_wrapper_hw_platform_0</a></li>\\n<li><a href=\\\"#project-ps_device_tree-device-tree\\\">Project: ps_device_tree Device tree</a></li>\\n<li><a href=\\\"#project-ps_mem_util-linux-shared-memory-utility\\\">Project: ps_mem_util Linux shared memory utility</a></li>\\n<li><a href=\\\"#project-mb_bsp-board-support-package-for-the-microblaze-processor\\\">Project: mb_bsp Board support package for the Microblaze processor</a></li>\\n<li><a href=\\\"#project-mb_hello-hello-world-application-for-microblaze\\\">Project: mb_hello Hello World application for Microblaze</a></li>\\n<li><a href=\\\"#project-mb_test-shared-memory-test-application-for-microblaze\\\">Project: mb_test Shared memory test application for Microblaze</a></li>\\n</ul>\\n</li>\\n<li>\\n<p><a href=\\\"#yocto\\\">Yocto</a></p>\\n<ul>\\n<li><a href=\\\"#device-tree\\\">Device tree</a></li>\\n<li><a href=\\\"#kernel\\\">Kernel</a></li>\\n<li><a href=\\\"#toolchain\\\">Toolchain</a></li>\\n<li><a href=\\\"#root-filesystem\\\">Root filesystem</a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"#testing\\\">Testing</a></li>\\n<li><a href=\\\"#conclusion\\\">Conclusion</a></li>\\n</ul>\\n<h1 id=\\\"introduction\\\"><a href=\\\"#introduction\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Introduction</h1>\\n<p>This article continues building upon the Linux platform which was set up in the previous article. Targeting the development of a music synthesizer, several building blocks have been explored: </p>\\n<ul>\\n<li>Hardware platform: Zynq 7020, Zedboard</li>\\n<li>Linux running on PS (dual core): systems management (MIDI, firmware management, embedded website)</li>\\n<li>I2S transmitter (implemented in logic), audio out</li>\\n<li>Sine wave oscillator</li>\\n<li>Possible use of a Microblaze softcore processor as co-processor.</li>\\n</ul>\\n<p>The synthesis engine will be implemented in logic (PL). The synthesis engine employs the additive synthesis method. It will support 32 voices, each voice will consist of 1024 oscillators. Each oscillator consists of a simple sine wave with frequency, amplitude and pan parameters. Furthermore there will be a noise generator for each oscillator that can add band limited noise. In total this means that 32768 oscillators have to be realized. These oscillators need to output 24 bit stereo samples at 44 kHz. </p>\\n<p>Input to the audio engine are the slowly varying frequency, amplitude, pan and noise parameters. Some sort of \\\"envelope generator\\\" is needed for this purpose. The idea is to have the oscillator tracks i ready to be used in main memory. Each track consists of frequency, amplitude, pan and noise parameters stored at 20 Hz time resolution. This data needs to be streamed to the audio engine which will then use this data to update the oscillators and provide the audio samples. The envelope generator needs to be able to respond in 5 ms to an event (eg. stop or start of a voice). Any more delay will be noticeable when using the synthesizer in a live performance. </p>\\n<p>It would be great if the envelope generator could be developed using a traditional programming language instead of resorting to a pure logic approach. A standard programming language would offer more ease while development and possibly greater flexibility. However an important drawback could be the performance of the software as the software needs to provide data at 20 Hz for 32768 oscillators. In this article and the following article I will focus on the feasibility to use a Microblaze softcore as a envelope generator. This article focuses on the basic architecture. In the next article I will be investigating the performance.</p>\\n<h1 id=\\\"concept\\\"><a href=\\\"#concept\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Concept</h1>\\n<p>This article describes the following work:</p>\\n<ul>\\n<li>Addition of a Microblaze softcore to the Zynq 7020 FPGA.</li>\\n<li>Program the Microblaze from Linux running on the PS.</li>\\n<li>Running bare metal firmware on the Microblaze.</li>\\n<li>Providing shared DDR memory between Linux and the Microblaze (Asymmetric Multi Processing).</li>\\n<li>Using Yocto to configure the Linux platform.</li>\\n</ul>\\n<p>Simplified the design consists of the following components:</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/schematic-14adae51be8797778242851946564e53-cefc6.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 793px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 96.09079445145018%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAAB00lEQVQ4y6WUCW7CMBBFuf/JipAKAgFhJ4hshIQlYV+mflYdWRCq0lqaOoyc5z9/Jq2IWpfLRY7Ho471ei1RGEij0ZAgCOV2u8k7q8Kf7XYj9/tdDBzoYrGQNE3/BsyyrABer1fZ7/eyWq1kt9sV+TcVbnW5KELdaDQUx+mJ687kfD5r1XZw6Y/A5XJZJCgRZVEUSZ7npQqBvgRS2qDfl8D3ZbPZyOFw0Ip7/Z7eKd9e5BJVyUtgtfoh7XZHOu22zGYzpTaWer0urWZTRUsypfIthXhnL/wht0wSrdbuMs/AyNs+2v4WQEozczgejaVWq8l0OtUTYGYUezzfE1dVwjM54DRzPB5JrHpRAM1OV2kIwUG7PM7gITAuNg3jUvLEE9A8A2ZHOS8TgPh9Op0KezhX6qHZucVxHD0y5FDIGNmRW416bNAT0PPm8qm6PBwM9cv/BrIw2n4BCD6VAfM8KyzQQIznAP5Qruk4nqVpojvKl5SocF33O5/KZDJ5apoG2jcDtVUC8tUXFIah/ooIzsTxQvwgUHtcDux2uroRHDLzaGYsUQOOEtRzFigqzWD/WqHxFY/4rwOYiKJQ5p6nwaVAFOEhB4DbC7MfZ9D8Nn4/Ar8ArcbDuIf0B7UAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"AMP schematic\\\"\\n        title=\\\"Asymmetric Multi Processing (AMP) setup\\\"\\n        src=\\\"/static/schematic-14adae51be8797778242851946564e53-cefc6.png\\\"\\n        srcset=\\\"/static/schematic-14adae51be8797778242851946564e53-3e77c.png 300w,\\n/static/schematic-14adae51be8797778242851946564e53-d20dc.png 600w,\\n/static/schematic-14adae51be8797778242851946564e53-cefc6.png 793w\\\"\\n        sizes=\\\"(max-width: 793px) 100vw, 793px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<h1 id=\\\"block-design\\\"><a href=\\\"#block-design\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Block Design</h1>\\n<h2 id=\\\"microblaze\\\"><a href=\\\"#microblaze\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Microblaze</h2>\\n<p>The Microblaze is configured to run code out of local BRAM memory. Furthermore it has a data cache to speed up accesses to DDR memory. The cache is connected via the HP0 port of the Zynq. This allows the Microblaze to access the DDR memory of the Zed board. This memory is shared with the Linux platform. </p>\\n<p>The Microblaze reset signal is connected to an AXI GPIO peripheral. This allows the Microblaze to be reset from Linux. The Xilinx SDK can generate some example applications. These applications require an uart is required. The Microblaze is configured with an AXI uartlite. This uart is connected to uart0 of the PS. This allows the serial output to be read from Linux without using any external cabling.</p>\\n<p>We want to use Linux to setup the firmware of the Microblaze. Thus Linux needs to have access to the BRAM. Unfortunately BRAM is only dual port, and both ports are in use by the Microblaze. A mux has been implemented which allows Linux to take control of the BRAM while the Microblaze is in reset. This will make it possible to program the Microblaze from within Linux.</p>\\n<h2 id=\\\"ps\\\"><a href=\\\"#ps\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>PS</h2>\\n<ul>\\n<li>\\n<p>The following PS peripherals are required in this project:</p>\\n<ul>\\n<li>PS Uart0 (auxiliary serial communication between Microblaze and Linux)</li>\\n<li>PS Uart1 (Linux console command line terminal)</li>\\n<li>DDR Ram</li>\\n<li>SD card (boot and root partition Linux)</li>\\n<li>M_AXI_GP0 (Access AXI peripherals) </li>\\n<li>S_AXI_HP0 (Microblaze access DDR RAM)</li>\\n</ul>\\n</li>\\n</ul>\\n<h2 id=\\\"axi-interconnect\\\"><a href=\\\"#axi-interconnect\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>AXI Interconnect</h2>\\n<p>The interconnect has two slave interfaces. One is connected to the PS, the other one to the Microblaze. This allows both the Microblaze and PS to access peripherals. The interconnect is attached to GPIO, a BRAM controller and an UARTlite. The peripherals have the following functions:</p>\\n<ul>\\n<li>\\n<p>The GPIO is used to control LEDs,  the Microblaze reset signal and the BRAM mux. </p>\\n<ul>\\n<li>The reset and mux signals have also been connected to LEDs and are controlled by the PS.</li>\\n<li>The remaining LEDs are controlled by both PS and Microblaze. </li>\\n</ul>\\n</li>\\n<li>The BRAM controller is used to allow accesses to the Microblaze BRAM from the PS.</li>\\n<li>The UARTlite is used by the Microblaze. The UARTlite is connected to the PS Uart0.</li>\\n</ul>\\n<h2 id=\\\"bram-mux\\\"><a href=\\\"#bram-mux\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>BRAM mux</h2>\\n<p>The BRAM mux allows one to connect two BRAM controllers to a single BRAM port. A control signal selects which BRAM controller is connected to the BRAM. In Vivado the IP packager was used to wrap a small VHDL module. In the IP packager the individual in and outputs of the VHDL entity can be grouped into bus interfaces. BRAM uses \\\"BRAM_CTRL\\\" interfaces. Some remarks:</p>\\n<ul>\\n<li>In a first try I packaged a block design with an embedded/referenced RTL module as an IP. Although this seems to be supported since Vivado 2018.1 I was not able to get this to work. When using the IP I always got an error during implementation of the design that the referenced RTL module could not be found while using the IP (Black box instantiation error).</li>\\n<li>Although the types of the input and output interfaces were set to BRAM_CTRL during packaging,  the type was showed as 'OTHER' while using the IP. This was solved by manually updating the block design in which the IP is used.</li>\\n</ul>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/bram_interface-13b114dea36fcf16a708a711f48fd751-a7362.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 1082px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.41774491682071%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABW0lEQVQoz5WRXU/CMBSG9/fVsYFeacQfYTDxTuOFIsog3MDGhAQY29w61m5r126LnkkgAyLRJ03ztul7vio93rdumlfN68uLc0WRTxqqXFfPVOW0UQchKzUQNTiqpZDvWreU0uQHENJivghXYRzFcP46Cks/bcfKsmx7I01nNsE4QEEcx2ma4hAjhHzP9zwPHzA2pyGhMRXrJVmWtY0EUaEE8JOIzpfIDxIcsayCMZ7sZLZtu2qG8OEKc84jgoVgIKqV75td193JDERl/a5rRcQXQhyaV1HqIoITLjmOI7IiIIkfQCqRshSyCS4YY3meF0VRNY90c2jOR5OlE7KZn5TmLC9iyhPG140dGfhwpMMDQkUYc5jGfs9/Mf/a8//Me1/1P7O9tOlRYPzlzxOCfGSaHzBIsUHSdX0wGHS72mvn/aX91m53Hp6eNU3r9XrrfUu/3zcMA2IlG74BacTXS1fd5DsAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"BRAM mux interface\\\"\\n        title=\\\"BRAM interface\\\"\\n        src=\\\"/static/bram_interface-13b114dea36fcf16a708a711f48fd751-a7362.png\\\"\\n        srcset=\\\"/static/bram_interface-13b114dea36fcf16a708a711f48fd751-1e477.png 300w,\\n/static/bram_interface-13b114dea36fcf16a708a711f48fd751-43255.png 600w,\\n/static/bram_interface-13b114dea36fcf16a708a711f48fd751-a7362.png 1082w\\\"\\n        sizes=\\\"(max-width: 1082px) 100vw, 1082px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<h2 id=\\\"address-map\\\"><a href=\\\"#address-map\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Address map</h2>\\n<p>Below you find an overview of the address of the various peripherals. </p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/address-780260080dd2af7cc08c080bb1274780-93fca.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 993px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 50.35246727089627%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABNUlEQVQoz5VR2U7DMBDM/38gDwjRJk7s+Frfac6KcQMF8QQrazWTvSfNpTdcEuN6EEZT1pSUjX98zYUZoZzzMeXp19OGpDTVKwuqlJXKGFOTla64acf88spf3+VbZ7mdez0JWnQ88KQ//abCDjC6VdAKCowc0CZNm7XEWpZT3rbt/sOMOeCtsfu+A/B+YF1PlpDG2k4KVYtLKQiMQoYQ5nl5FudUPaInTTF5H27TDRiZOZeGQhaD8M7PqFuW4z9WJ8cQRzGu64qW+PSc7Khi9D2pkpLzOgZXCC6U1LUY/Hq5DmzAPdit5HIur+QBESD37WHnzY4cFuyu7efNKaW+Y1/Lf98c4x1KTWWCQSREnXPogu2AMKOJZSX8yVHWP0iIe8iO3lWwXFuc2Q/9UowR0oAClDJ9ABB6OSg8EvJNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"AXI address map\\\"\\n        title=\\\"Address Map\\\"\\n        src=\\\"/static/address-780260080dd2af7cc08c080bb1274780-93fca.png\\\"\\n        srcset=\\\"/static/address-780260080dd2af7cc08c080bb1274780-85d1c.png 300w,\\n/static/address-780260080dd2af7cc08c080bb1274780-28c3d.png 600w,\\n/static/address-780260080dd2af7cc08c080bb1274780-93fca.png 993w\\\"\\n        sizes=\\\"(max-width: 993px) 100vw, 993px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>Note that the UartLite is not used by the PS and the BRAM controller is not used by the Microblaze.</p>\\n<h1 id=\\\"sdk\\\"><a href=\\\"#sdk\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>SDK</h1>\\n<p>The block design was synthesized and exported to the SDK. In the SDK several projects were created. </p>\\n<h2 id=\\\"cross-compilation\\\"><a href=\\\"#cross-compilation\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Cross compilation</h2>\\n<p>To develop and compile software on a development X86 platform cross compilation toolchains are required. In the AMP design a toolchain for the PS (ARM A9) and Microblaze will be used.</p>\\n<h3 id=\\\"ps-1\\\"><a href=\\\"#ps-1\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>PS</h3>\\n<p>Vivado is delivered including the ARM toolchain required for compiling programs for the Zynq A9 processors. Yocto can also generate the cross compilation toolchain. In order to test Yocto, the toolchain generated by Yocto is used. See the toolchain paragraph in the Yocto section for more info. To use the Yocto toolchain in the Xilinx SDK (Eclipse) right click a project and then select \\\"C/C++ build -> Settings\\\". Use the following settings (replace 'sdk install path' with the correct path):</p>\\n<div style='overflow:auto;width:100%'>\\n<pre>\\nAssembler: \\n  [sdk install path]/sysroots/ x86_64-pokysdk-linux/ usr/ bin/arm-poky-linux-gnueabi/arm-poky-linux-gnueabi-gcc\\nCompiler: \\n  [sdk install path]/sysroots/x86_64-pokysdk-linux/usr/bin/arm-poky-linux-gnueabi/arm-poky-linux-gnueabi-gcc\\n  All options: -Wall -O0 -g3 -I\\\"[sdk install path]/sysroots/cortexa9hf-neon-poky-linux-gnueabi/usr/include\\\" -c -fmessage-length=0 -MT\\\"$@\\\" -march=armv7-a -marm -mfpu=neon -mfloat-abi=hard -mcpu=cortex-a9 --sysroot=[sdk install path]/sysroots/cortexa9hf-neon-poky-linux-gnueabi\\n  Directories - Include paths: [sdk install path]/sysroots/cortexa9hf-neon-poky-linux-gnueabi/usr/include \\n  Miscellaneous : -c -fmessage-length=0 -MT\\\"$@\\\" -march=armv7-a -marm -mfpu=neon -mfloat-abi=hard -mcpu=cortex-a9 --sysroot=[sdk install path]/sdk/sysroots/cortexa9hf-neon-poky-linux-gnueabi\\nLinker:\\n  Command: /home/dinne/yocto/sdk/sysroots/x86_64-pokysdk-linux/usr/bin/arm-poky-linux-gnueabi/arm-poky-linux-gnueabi-gcc\\n  All options: -L\\\"[sdk install path]/sdk/sysroots/cortexa9hf-neon-poky-linux-gnueabi/usr/lib\\\" -L\\\"[sdk install path]/sysroots/cortexa9hf-neon-poky-linux-gnueabi/lib\\\" --sysroot=[sdk install path]/sysroots/cortexa9hf-neon-poky-linux-gnueabi\\n  Libraries: [sdk install path]/sysroots/cortexa9hf-neon-poky-linux-gnueabi/usr/lib \\n    and \\n             [sdk install path]/sysroots/cortexa9hf-neon-poky-linux-gnueabi/lib\\n  Miscellaneous: --sysroot=[sdk install path]/sysroots/cortexa9hf-neon-poky-linux-gnueabi\\n</pre>\\n</div>\\n&nbsp;\\n&nbsp;\\n<h3 id=\\\"microblaze-1\\\"><a href=\\\"#microblaze-1\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Microblaze</h3>\\n<p>The toolchain included in Vivado was used to compile the Microblaze examples. A post build command was added to generate the .bin images which can be copied into the BRAM.</p>\\n<div style='overflow:auto;width:100%'>\\n<pre>mb-objcopy -I elf32-microblaze -O binary --strip-debug mb_hello.elf mb_hello.bin</pre>\\n</div>\\n<h2 id=\\\"project-design_1_wrapper_hw_platform_0\\\"><a href=\\\"#project-design_1_wrapper_hw_platform_0\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Project: design_1_wrapper_hw_platform_0</h2>\\n<p>Contains the fpga bit file. </p>\\n<h2 id=\\\"project-ps_device_tree-device-tree\\\"><a href=\\\"#project-ps_device_tree-device-tree\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Project: ps_device_tree Device tree</h2>\\n<p>This project generates the device trees required for Yocto Linux.</p>\\n<h2 id=\\\"project-ps_mem_util-linux-shared-memory-utility\\\"><a href=\\\"#project-ps_mem_util-linux-shared-memory-utility\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Project: ps_mem_util Linux shared memory utility</h2>\\n<p>This project builds a simple memory IO utility. It allows one to read or write a range of physical memory addresses. The utility can copy a file to memory or read a file from memory. </p>\\n<ul>\\n<li>The utility can be used to copy shared memory to a file. In this case memory is read from the range 0x1000_0000 - 0x1e00_0000</li>\\n<li>The utility can be used to program the Microblaze. In this case a file is copied to memory location 0x4000_0000 - 0x4000_7FFF</li>\\n</ul>\\n<p>The utility makes use of the Linux mmap function. To access memory:</p>\\n<ol>\\n<li>Open the \\\"/dev/mem\\\" device with O_RDWR and O_SYNC options. O_SYNC is required to disable caching.</li>\\n<li>\\n<p>Use mmap:</p>\\n<div style='overflow:auto;width:100%'>\\n<pre>\\nbase_address = mmap(0, size_rounded, PROT_READ, MAP_SHARED | MAP_UNINITIALIZED, fd, load_address);\\n</pre>\\n</div>\\n</li>\\n</ol>\\n<p>where \\\"size_rounded\\\" is the size of the memory area roundup to the nearest size in whole pages.  \\\"load_address\\\" is the physical address which will be mapped. The returned \\\"base_address\\\" is a pointer to the mapped memory. </p>\\n<ol start=\\\"3\\\">\\n<li>\\n<p>The memory can then be accessed:</p>\\n<div style='overflow:auto;width:100%'>\\n<pre>base\\\\_address[offset] = data</pre>\\n</div>\\n</li>\\n</ol>\\n<p>Have look at the ps_mem_util source code for the details. Note that the code is only a \\\"proof of concept\\\" and is very inefficient.</p>\\n<p>Note. According to the mmap documentation the first parameter is a hint to the address that should be mapped. The last argument is the offset. Initially I tried: </p>\\n<div style='overflow:auto;width:100%'>\\n<pre>\\n    base_address = mmap(load_address, size_rounded, PROT_READ, MAP_SHARED | MAP_UNINITIALIZED | MAP_FIXED, fd, 0);\\n</pre>\\n</div>\\nFor reasons unknown to me this does not work!\\n<p> \\n </p>\\n<h2 id=\\\"project-mb_bsp-board-support-package-for-the-microblaze-processor\\\"><a href=\\\"#project-mb_bsp-board-support-package-for-the-microblaze-processor\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Project: mb_bsp Board support package for the Microblaze processor</h2>\\n<p>A board support package was generated for the Microblaze processor. Libmetal was disabled in order to fit the example application into 32kB BRAM.</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/mb_bsp-58486d814463a539d40b138a806592e7-3006c.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 1200px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 45.62500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABXUlEQVQoz22QW07DMBBFs//FID7YACqF8hSg/qC2qRPH9sTxu0lqkrRhoqIKAdaRJcs+c2ecGEENp4ZlihdGVVZXuEsQm9UHSdc5Sf9FsCJYk/j1MiwXNdCdd7FtjsMwHg48z2az6/nN7H5xd3c7f3p8eHl++snV5cXxeEyckpIzpZT3PoRQ13WMURaZebs127SEyhrNOSsoPYMHEGKSd86KYort4h7pPyNitOr73tlAtoBD0DzPswwFAAGClyAozbuuS2otGwWNkkPfHfp+QIbBWjuOo3c7lAVHhWMJpJLfu+AMqydt03zGuG/3QghT7jq26TmxLEcZrzBNyrIEcM62TX0Gw6e2T6MqpbGpirm4fu/OctsAlM45Sulqtd5sUgCQUqLCOZ9kC8wb7Yyugx8Pwwnv7EnGpzgCZ4wQwhhD2RgTgodTMrY+/llaa/wjOpH9gmzT7HVBli8ofwHXI+6CVv2SqAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"Mircoblaze bsp\\\"\\n        title=\\\"Microblaze board support package\\\"\\n        src=\\\"/static/mb_bsp-58486d814463a539d40b138a806592e7-bf66f.png\\\"\\n        srcset=\\\"/static/mb_bsp-58486d814463a539d40b138a806592e7-e6e4d.png 300w,\\n/static/mb_bsp-58486d814463a539d40b138a806592e7-04aa4.png 600w,\\n/static/mb_bsp-58486d814463a539d40b138a806592e7-bf66f.png 1200w,\\n/static/mb_bsp-58486d814463a539d40b138a806592e7-3006c.png 1760w\\\"\\n        sizes=\\\"(max-width: 1200px) 100vw, 1200px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<h2 id=\\\"project-mb_hello-hello-world-application-for-microblaze\\\"><a href=\\\"#project-mb_hello-hello-world-application-for-microblaze\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Project: mb_hello Hello World application for Microblaze</h2>\\n<p>The Xilinx \\\"test peripheral\\\" template was chosen. Check that the ldscript.ld Linker script only references the BRAM. </p>\\n<p>The test application flash all the GPIOs/LEDs. Bit 13 and 12 of the GPIO are reserved for the PS to reset the Microblaze and to control the BRAM Mux. The test code is modified so that it doesn't toggle these bits :).</p>\\n<h2 id=\\\"project-mb_test-shared-memory-test-application-for-microblaze\\\"><a href=\\\"#project-mb_test-shared-memory-test-application-for-microblaze\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Project: mb_test Shared memory test application for Microblaze</h2>\\n<p>This application shows how to write to the shared memory. First the address of the start of shared memory is obtained:</p>\\n<pre>uint32_t addr = XPAR_PS7_DDR_0_HP0_AXI_BASENAME;</pre>\\n<p>Next a byte can be changed as follows:</p>\\n<pre>\\t\\t\\ndata_ptr = (uint8_t*)(addr+offset);\\n*data_ptr = value;\\n</pre>\\n<p>Again note that is purely \\\"proof of concept\\\" and not an example of efficient memory accessing! Note also that in this example the caches have been disabled.</p>\\n<h1 id=\\\"yocto\\\"><a href=\\\"#yocto\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Yocto</h1>\\n<p>The Linux kernel is built using Yocto. The yocto tools are available using Docker. First build the docker image:</p>\\n<pre>\\ncd yocto\\nmake image\\n</pre>\\n<p>Then start a container in which to perform work:</p>\\n</pre>./run.sh</pre>\\n<p>Inside the container, first perform <pre>su [username]</pre> to get to the right user. Then cd to your home dir (which is mounted inside the container) and then to the yocto dir. Next run the build.sh script to build the Yocto image. This will take a while!</p>\\n</pre>./build.sh</pre>\\n<p>If you want to make changes to the configuration refer the sections below. Reconfiguring the kernel must be done from inside the container environment. After saving the changes rebuild the image:</p>\\n<div style='overflow:auto;width:100%'>\\n<pre>\\ncd yocto_zedboard/yocto_build_env/poky\\nsource oe-init-build-env\\nbitbake bitbake core-image-minimal\\n</pre>\\n</div>\\n<p>Note: Bitbake currently uses Python2. I use conda to switch to Python2 before using the bitbake utility.</p>\\n<h2 id=\\\"device-tree\\\"><a href=\\\"#device-tree\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Device tree</h2>\\n<p>The device tree generated by Vivado is a good starting point for further customization. Some changes were made:</p>\\n<ul>\\n<li>The memory range 0x1000_0000 to 0x1e00_0000 is setup as \\\"reserved memory\\\". The Linux kernel will not use this memory. The memory will be available for use as shared memory between the Microblaze processor and Linux user space applications. </li>\\n<li>Vivado automatically added an AXI uartlite device. However this device will be only used by the Microblaze. Thus the AXI UartLite is removed and the Uart indexes have been shifted accordingly.</li>\\n</ul>\\n<p>The AXI GPIO and AXI Bram controller have been integrated unchanged from the Vivado device tree files. The modified device tree files can be found in the Yocto 'meta-dts' layer (yocto/meta-dts/recipes-kernel/linux/linux-xlnx/zedboard-zynq7)</p>\\n<h2 id=\\\"kernel\\\"><a href=\\\"#kernel\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Kernel</h2>\\n<p>During development it's nice to have more debugging facilities on the Linux platform. Therefore the debugfs tools have been enabled in the kernel. In yocto it is possible to override the kernel configuration file completely. It is also possible to specify only changed configuration options in a socalled 'fragment'. The changed options are merged by Yocto into the kernel configuration. A pre configured fragment can be found in yocto/meta-dts/recipes-kernel/linux/linux-xlnx/zedboard-zynq7/fragment.cfg. </p>\\n<p>Creating a fragment can be done as follows (this has already been done in the repo):</p>\\n<ul>\\n<li>\\n<p>First build a minimal image </p>\\n<pre>bitbake core-image-minimal</pre>\\n</li>\\n<li>\\n<p>configure the kernel</p>\\n<pre>bitbake linux-xlnx -c menuconfig</pre>\\n</li>\\n<li>\\n<p>Then create a diff fragment</p>\\n<pre>bitbake linux-xlnx -c diffconfig</pre>\\n</li>\\n<li>Copy the fragment to the meta-dts layer and add it to the kernel recipes-kernel/linux/linux-xlnx_%.bbappend file.  </li>\\n<li>\\n<p>Rebuild the image</p>\\n<pre>bitbake core-image-minimal</pre>\\n</li>\\n</ul>\\n<h2 id=\\\"toolchain\\\"><a href=\\\"#toolchain\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Toolchain</h2>\\n<p>Yocto can generate an installer with the cross compilers required for build software for the Zynq Linux platform. The SDK can be generated by using bitbake</p>\\n<pre>bitbake core-image-minimal -c populate_sdk</pre>\\n<p>Initially this command gave a number of errors because of missing dependencies, these have been added to the yocto/ meta-dts/ recipes-kernel/ linux/ kernel-devsrc.bbappend file.</p>\\n<p>After building the SDK can be found in:</p>\\n<div style='overflow:auto;width:100%'>\\n<pre>\\npoky/build/tmp/work/zedboard_zynq7-poky-linux-gnueabi/core-image-minimal/1.0-r0/x86_64-deploy-core-image-minimal-populate-sdk/ poky-glibc-x86_64-core-image-minimal-cortexa9hf-neon-toolchain-2.5.2.sh\\n</pre>\\n</div>\\n<p>Execute the script to install the SDK.</p>\\n<h2 id=\\\"root-filesystem\\\"><a href=\\\"#root-filesystem\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Root filesystem</h2>\\n<p>I use an Ubuntu root filesystem. Installing this is described in the previous article. One patch is needed. The toolchain compiled by Yocto expects the system library to be at a certain location. If it is not then execution of applications compiled with the toolchain will fail with a very vague error. To get the applications built with the Yocto toolchain working a sym link has to be added.</p>\\n<h1 id=\\\"testing\\\"><a href=\\\"#testing\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Testing</h1>\\n<p>After building the Linux kernel copy the files to an SD card. Formatting the SD card is described in the previous article. </p>\\n<p>Copy the files located in \\\"poky/build/tmp/deploy/images/zedboard-zynq7\\\" to the boot partition:</p>\\n<ul>\\n<li>\\n<p>boot.bin -> boot/boot.bin The first stage bootloader</p>\\n</li>\\n<li>\\n<p>system-top.dtb -> uImage-system-top.dtb (Compiled device tree)</p>\\n</li>\\n<li>\\n<p>u-boot.img -> u-boot.img (Kernel bootloader)</p>\\n</li>\\n<li>\\n<p>uImage -> uImage (Linux kernel)</p>\\n</li>\\n<li>\\n<p>Add a uEnv.txt file:</p>\\n<div style='overflow:auto;width:100%'>\\n<pre>\\nmachine_name=zedboard-zynq7\\nkernel_image=uImage\\nkernel_load_address=0x2080000\\ndevicetree_image=uImage-system-top.dtb\\ndevicetree_load_address=0x2000000\\nbootargs=console=ttyPS0,115200 root=/dev/mmcblk0p2 rw earlyprintk rootfstype=ext4 rootwait devtmpfs.mount=1\\nloadkernel=fatload mmc 0 ${kernel_load_address} ${kernel_image}\\nloaddtb=fatload mmc 0 ${devicetree_load_address} ${devicetree_image}\\nbootkernel=run loadkernel && run loaddtb && bootm ${kernel_load_address} - ${devicetree_load_address}\\nuenvcmd=run bootkernel\\n</pre>\\n</div>\\n</li>\\n</ul>\\n<p> \\n </p>\\n<ul>\\n<li>\\n<p>Convert the fpga bit file (in the design_1_wrapper_hw_platform_0) to a fpga.bin file using the yocto/fpga-bit-to-bin.py script. Copy it to the boot partition -> fpga.bin</p>\\n</li>\\n<li>\\n<p>Copy the compiled executable ps_mem_util.elf (from the SDK) to the root partition /root/ubuntu/</p>\\n</li>\\n<li>\\n<p>Copy the mb_test.bin and mb_hello.bin firmware images (from the SDK) to the root partition /root/ubuntu/</p>\\n</li>\\n<li>\\n<p>Copy the microblaze scripts program_mb, unlock_bram and release_mb from the yocto_zedboard/yocto/linux_utils/ folder to the root partition /root/ubuntu</p>\\n</li>\\n</ul>\\n<p>Unmount the SD card and plug it in the Zedboard. Connect a USB cable to UART connector and power on the Zed board. Wait a +/- 20 second and then use a terminal program to open a serial terminal (eg. /dev/ttyACM0). Press the PS-RST button to reboot linux. You should see the boot messages on the terminal.</p>\\n<p>Login as root. </p>\\n<p>Use the Perform the following commands:</p>\\n<pre>\\n./program_mb mb_hello.bin\\n./unlock_bram.sh\\n./release_mb.sh\\n</pre>\\n<p>You should see the LEDs being turned on and off by the Microblaze.</p>\\n<p>Test the shared memory:</p>\\n<pre>\\n/program_mb mb_test.bin\\n./unlock_bram.sh\\n./release_mb.sh\\n</pre>\\n<p>Wait a second and then use the ps_mem_utility to read 512 bytes from the shared memory:</p>\\n<pre>\\nps\\\\_mem\\\\_util r 0x10000000 512 test.bin\\n</pre>\\n<p>This file should contain increasing numbers which were written in the memory by the microblaze.</p>\\n<h1 id=\\\"conclusion\\\"><a href=\\\"#conclusion\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Conclusion</h1>\\n<p>This article showed how to set up a basic AMP system using Linux on the ARM A9 cores and a bare metal Microblaze core.  It will be interesting to see if enough performance can be squeezed out of the  Microblaze to handle streaming the sine track parameters. This will be investigated further in the following article.</p>\\n<p>The Vivado project, VHDL code and Yocto files can be found in the <a href=\\\"https://github.com/dwjbosman/yocto_zedboard.git\\\">yocto_zedboard</a> repository in the AMP branch.</p>\",\"timeToRead\":15,\"excerpt\":\"Table of Contents Introduction Concept Block Design Microblaze PS AXI Interconnect BRAM mux Address map SDK Cross compilation PS Microblaze…\",\"frontmatter\":{\"title\":\"Basic Asymmetric Multi Processor (AMP) setup on the Zedboard\",\"cover\":\"/logos/cpus.jpg\",\"date\":\"2019-03-05 09:00\",\"category\":\"FPGA\",\"tags\":[\"Zynq Microblaze Yocto Linux Xilinx\"]},\"fields\":{\"nextTitle\":null,\"nextSlug\":null,\"prevTitle\":null,\"prevSlug\":null,\"slug\":\"/basic-asymmetric-multi-processor-amp-setup-on-the-zedboard\"}}},\"pathContext\":{\"slug\":\"/basic-asymmetric-multi-processor-amp-setup-on-the-zedboard\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/json-loader!./.cache/json/basic-asymmetric-multi-processor-amp-setup-on-the-zedboard.json\n// module id = 454\n// module chunks = 215454216127061"],"sourceRoot":""}